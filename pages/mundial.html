<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcador LLF</title>
    <link rel="stylesheet" href="../css/mundial.css">
    <link rel="icon" type="image/x-icon" href="../imgs/favicon.ico">
</head>

<body>

    <div class="marcador">
        <div class="bloque-goles goles-pos-1" id="goles1">0</div>
        <div id="equipo1-abv" class="equipo-abv">EQ1</div>
        <img id="escudo1" src="" class="escudo1">
        <div class="cronometro" id="cronometro">15:00</div>
        <img id="escudo2" src="" class="escudo2">
        <div id="equipo2-abv" class="equipo-abv">EQ2</div>
        <div class="bloque-goles goles-pos-2" id="goles2">0</div>

        <div class="temporizador-extra" id="temporizador-extra">+0</div>

        <div id="animacion-marcador-alto" class="overlay-marcador-alto"></div>

        <div id="animacion-gol" class="overlay-gol">
            <div class="contenido-gol">
                <span class="texto-gol">GOOOOOOOL</span>
                <img id="escudo-gol" src="" alt="escudo" class="escudo-fondo">
            </div>
        </div>
        <div class="marcador2">
            <div class="bloque-goles1 goles-pos-3" id="goles3">0</div>
            <div id="equipo1-name" class="equipo-abv1">EQ1</div>
            <img id="escudo1-max" src="" class="escudo1-max">
            <div class="cronometro1" id="cronometro1">15:00</div>
            <img id="escudo2-max" src="" class="escudo2-max">
            <div id="equipo2-name" class="equipo-abv1">EQ2</div>
            <div class="bloque-goles1 goles-pos-4" id="goles4">0</div>

            <div class="temporizador-extra1" id="temporizador-extra1">+0</div>

            <div id="animacion-marcador-bajo" class="overlay-marcador-bajo"></div>
        </div>
    </div>

    <div>
        <h2>Equipo 1</h2>
        <div class="equipos" id="botonesEq1"></div>

        <h2>Equipo 2</h2>
        <div class="equipos" id="botonesEq2"></div>

        <br>

        <button onclick="sumar(1)">+1 EQ1</button>
        <button onclick="restar(1)">-1 EQ1</button>
        <button onclick="sumar(2)">+1 EQ2</button>
        <button onclick="restar(2)">-1 EQ2</button>
        <br>
        <button onclick="iniciar()">Iniciar</button>
        <button onclick="detener()">Detener</button>
        <button onclick="reiniciar()">Reiniciar</button>
        <br>
        <h2>Tiempo añadido</h2>
        <button onclick="anadirTiempo(1)">+1</button>
        <button onclick="anadirTiempo(2)">+2</button>
        <button onclick="anadirTiempo(3)">+3</button>
        <button onclick="anadirTiempo(4)">+4</button>
        <button onclick="anadirTiempo(5)">+5</button>
        <br>
        <a href="../marcadores.html">
            <button>Volver</button>
        </a>
    </div>

    <audio id="reproductorGol" src=""></audio>

    <script>
        const equipos = [
            { abv: "ESP", color: "#0242a1", escudo: "../imgs/banderas/españa.png", himno: "../audios/general.mp3", nombre: "ESPAÑA" },
            { abv: "ARG", color: "#831f18", escudo: "../imgs/banderas/argentina.png", himno: "../audios/liverpool.mp3", nombre: "ARGENTINA" },
            { abv: "FRA", color: "#69acd8", escudo: "../imgs/banderas/france.png", himno: "../audios/general.mp3", nombre: "FRANCIA" },
            { abv: "ENG", color: "#03da18", escudo: "../imgs/banderas/england.png", himno: "../audios/betis.mp3", nombre: "INGLATERRA" },
            { abv: "BRA", color: "#e01f1a", escudo: "../imgs/banderas/brazil.png", himno: "../audios/atleti.mp3", nombre: "BRASIL" },
            { abv: "POR", color: "#f1c40f", escudo: "../imgs/banderas/portugal.png", himno: "../audios/villarreal.mp3", nombre: "PORTUGAL" },
            { abv: "NED", color: "#d9d9d9", escudo: "../imgs/banderas/netherlands.png", himno: "../audios/juve.mp3", nombre: "PAÍSES BAJOS" },
            { abv: "BEL", color: "#693de2", escudo: "../imgs/banderas/belgium.png", himno: "../audios/fiore.mp3", nombre: "BÉLGICA" },
            { abv: "GER", color: "#009dff", escudo: "../imgs/banderas/germany.png", himno: "../audios/napoli.mp3", nombre: "ALEMANIA" },
            { abv: "CRO", color: "#881f19", escudo: "../imgs/banderas/croatia.png", himno: "../audios/general.mp3", nombre: "CROACIA" },
            { abv: "MOR", color: "#881f19", escudo: "../imgs/banderas/morocco.png", himno: "../audios/general.mp3", nombre: "MARRUECOS" },
            { abv: "ITA", color: "#881f19", escudo: "../imgs/banderas/italy.png", himno: "../audios/general.mp3", nombre: "ITALIA" },
            { abv: "COL", color: "#881f19", escudo: "../imgs/banderas/colombia.png", himno: "../audios/general.mp3", nombre: "COLOMBIA" },
            { abv: "USA", color: "#881f19", escudo: "../imgs/banderas/usa.png", himno: "../audios/general.mp3", nombre: "EE.UU." },
            { abv: "MEX", color: "#881f19", escudo: "../imgs/banderas/mexico.png", himno: "../audios/general.mp3", nombre: "MÉXICO" },
            { abv: "URU", color: "#881f19", escudo: "../imgs/banderas/uruguay.png", himno: "../audios/general.mp3", nombre: "URUGUAY" },
        ];

        let marcador1 = 0, marcador2 = 0;
        let tiempo = 0, intervalo;
        let tiempoExtra = 0;

        const res = document.getElementById("resultado");
        const cron = document.getElementById("cronometro");
        const cron1 = document.getElementById("cronometro1");
        const extraDiv = document.getElementById("temporizador-extra");
        const extraDiv1 = document.getElementById("temporizador-extra1");

        function actualizarMarcador() {
            document.getElementById("goles1").textContent = marcador1;
            document.getElementById("goles3").textContent = marcador1;
            document.getElementById("goles2").textContent = marcador2;
            document.getElementById("goles4").textContent = marcador2;
        }

        // Variable global para controlar el audio
        const reproductor = document.getElementById("reproductorGol");

        function sumar(equipoNum) {
            // 1. Obtener la abreviatura que está escrita actualmente en el marcador
            let abvEquipo = document.getElementById(`equipo${equipoNum}-abv`).textContent;

            // 2. Buscar los datos de ese equipo en nuestro array
            let datosEquipo = equipos.find(e => e.abv === abvEquipo);

            // 3. Sumar el gol
            if (equipoNum === 1) marcador1++;
            else marcador2++;

            actualizarMarcador();

            // 4. Lanzar animación y sonido si el equipo existe
            if (datosEquipo) {
                lanzarAnimacionGol(datosEquipo.escudo);
                reproducirHimno(datosEquipo.himno);
            }
        }

        function reproducirHimno(rutaAudio) {
            if (rutaAudio) {
                reproductor.src = rutaAudio; // Cambiamos la canción a la del equipo que marcó
                reproductor.volume = 0.7;    // Ajusta el volumen a tu gusto (0.0 a 1.0)
                reproductor.play();          // ¡Suena el gol!
            }
        }

        // Modificamos también la animación para que cuando se limpie, el audio se detenga o baje
        function lanzarAnimacionGol(urlEscudo) {
            const overlay = document.getElementById("animacion-gol");
            const imgEscudo = document.getElementById("escudo-gol");

            imgEscudo.src = urlEscudo;

            overlay.classList.remove("animar-gol");
            void overlay.offsetWidth;
            overlay.classList.add("animar-gol");

            setTimeout(() => {
                overlay.classList.remove("animar-gol");
                // Opcional: Desvanecer el audio gradualmente al terminar la animación
                let fadeOut = setInterval(() => {
                    if (reproductor.volume > 0.1) {
                        reproductor.volume -= 0.1;
                    } else {
                        reproductor.pause();
                        clearInterval(fadeOut);
                    }
                }, 200);
            }, 4000); // He subido a 4 segundos para que dé tiempo a escuchar el audio
        }

        let estadoMarcador = 1; // 0: Tapa Alto, 1: Tapa Bajo

        function alternarMarcadores() {
            const tapaAlto = document.getElementById("animacion-marcador-alto");
            const tapaBajo = document.getElementById("animacion-marcador-bajo");

            if (estadoMarcador === 0) {
                // TAPAR ALTO - MOSTRAR BAJO
                tapaAlto.classList.add("tapado");
                tapaBajo.classList.remove("tapado");
                console.log("Modo: Viendo marcador BAJO (grande)");
                estadoMarcador = 1;
            } else {
                // TAPAR BAJO - MOSTRAR ALTO
                tapaBajo.classList.add("tapado");
                tapaAlto.classList.remove("tapado");
                console.log("Modo: Viendo marcador ALTO (pequeño)");
                estadoMarcador = 0;
            }
        }

        // Iniciar el ciclo
        function iniciarCicloSeguro() {
            // Ejecución inicial
            alternarMarcadores();

            // Cambiar cada 4 minutos (240.000 ms)
            setInterval(alternarMarcadores, 240000);
        }

        iniciarCicloSeguro();

        function restar(equipo) {
            if (equipo === 1 && marcador1 > 0) marcador1--;
            else if (equipo === 2 && marcador2 > 0) marcador2--;
            actualizarMarcador();
        }

        function actualizarTiempo() {
            let min = Math.floor(tiempo / 60);
            let seg = tiempo % 60;
            if (seg < 10) seg = "0" + seg;
            if (min < 10) min = "0" + min;
            cron.textContent = `${min}:${seg}`;
            cron1.textContent = `${min}:${seg}`;
        }

        // --- LÓGICA DE TIEMPO EXTRA MODIFICADA ---

        function actualizarTemporizadorExtra() {
            extraDiv.textContent = "+" + tiempoExtra;
            extraDiv1.textContent = "+" + tiempoExtra;
        }

        function anadirTiempo(min) {
            tiempoExtra += min;
            actualizarTemporizadorExtra();
            // Solo mostramos el cuadro azul (display block) no movemos nada mas
            extraDiv.classList.add("activo");
            extraDiv1.classList.add("activo");

        }

        // --- CONTROL DEL TIEMPO ---

        function iniciar() {
            if (intervalo) clearInterval(intervalo);
            intervalo = setInterval(() => {
                tiempo++;
                actualizarTiempo();
            }, 1000);
        }

        function detener() {
            clearInterval(intervalo);
        }

        function reiniciar() {
            clearInterval(intervalo);
            tiempo = 0;
            tiempoExtra = 0;
            actualizarTiempo();

            // Ocultar el extra al reiniciar
            extraDiv.classList.remove("activo");
            extraDiv1.classList.remove("activo");
        }

        // ... (Tu función crearBotonesEquipos sigue igual) ...
        function crearBotonesEquipos(containerId, equipoNum) {
            const cont = document.getElementById(containerId);
            equipos.forEach(eq => {
                const btn = document.createElement("button");
                btn.className = "boton-escudo";
                // Nota: He quitado la imagen para el ejemplo si no carga, pero dejalo como lo tenias
                btn.innerHTML = `<img src="${eq.escudo}" alt="${eq.abv}" width="20">`;
                btn.onclick = () => {
                    document.getElementById(`equipo${equipoNum}-abv`).textContent = eq.abv;
                    document.getElementById(`escudo${equipoNum}`).src = eq.escudo;
                    document.getElementById(`equipo${equipoNum}-name`).textContent = eq.nombre;
                    document.getElementById(`escudo${equipoNum}-max`).src = eq.escudo;
                };
                cont.appendChild(btn);
            });
        }

        crearBotonesEquipos("botonesEq1", 1);
        crearBotonesEquipos("botonesEq2", 2);

        actualizarMarcador();
        actualizarTiempo();
    </script>
</body>

</html>